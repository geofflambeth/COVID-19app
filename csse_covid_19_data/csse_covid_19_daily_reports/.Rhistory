)
# Define server logic
shinyServer(function(input, output) {
#Plot needs to go HERE:
output$CasesAdmin2 <- renderPlotly(CasesAdmin2)
output$CasesProvinceState <- renderPlotly(CasesProvinceState)
output$CasesCountryRegion <- renderPlotly(CasesCountryRegion)
output$NewCasesAdmin2 <- renderPlotly(NewCasesAdmin2)
output$NewCasesProvinceState <- renderPlotly(NewCasesProvinceState)
output$NewCasesCountryRegion <- renderPlotly(NewCasesCountryRegion)
output$ProvinceStatePieChart <- renderPlotly(ProvinceStatePieChart)
})
ProvinceStateTrend
Admin2Trend
runApp()
##V2.0 Beta
#Load Packages
library("dplyr")
library("plotly")
library("lubridate")
library("shiny")
library("accelerometry")
library("RCurl")
#Load JohnsHopkinsAll from GitHub
#JohnsHopkinsAll.csv needs to be updated manually using update.R
#Script references the master branch, so remember to update the MASTER branch not just the BETA branch
#FEATURE TO ADD LATER <- Possible to write this update into script automatically? Need to solve github sync issue with large files....
##### NECESSARY FOR WEB PUBLISHING #####
#GitHubURL <- getURL("https://raw.githubusercontent.com/geofflambeth/COVID-19app/master/ShinyApp/JohnsHopkinsAll.csv")
#JohnsHopkinsAll <- read.csv(text = GitHubURL)
#JohnsHopkinsAll$Date <- parse_date_time(JohnsHopkinsAll$Date, orders = c("ymd"))
#JohnsHopkinsAll$DateTime <- parse_date_time(JohnsHopkinsAll$DateTime, orders = c("ymd_HMS"))
##### FASTER FOR LOCAL USE #####
setwd("~/Google Drive/GitHub/COVID-19app/ShinyApp/")
JohnsHopkinsAll <- read.csv("JohnsHopkinsAll.csv")
JohnsHopkinsAll$Date <- parse_date_time(JohnsHopkinsAll$Date, orders = c("ymd"))
JohnsHopkinsAll$DateTime <- parse_date_time(JohnsHopkinsAll$DateTime, orders = c("ymd_HMS"))
##FILTER RULES HERE##
today <- format(Sys.Date(), "%Y-%m-%d 00:00:00")
CountryRegionFilter <- "Brazil"
ProvinceStateFilter <- "Sao Paolo"
Admin2Filter <- "Santa Fe"
Exclusion1 <- "2020-04-22"
Exclusion1 <- parse_date_time(Exclusion1, orders = "ymd")
Exclusion2 <- "2020-04-23"
Exclusion2 <- parse_date_time(Exclusion2, orders = "ymd")
Exclusion3 <- "2020-04-13"
Exclusion3 <- parse_date_time(Exclusion3, orders = "ymd")
Exclusion4 <- "2020-04-27"
Exclusion4 <- parse_date_time(Exclusion4, orders = "ymd")
Exclusion5 <- "2020-04-28"
Exclusion5 <- parse_date_time(Exclusion5, orders = "ymd")
#Filter JohnsHopkinsAll
#FEATURE TO ADD LATER <- Select filters from ShinyApp ui.R
JohnsHopkinsAll <- filter(JohnsHopkinsAll, Date != Exclusion1)
JohnsHopkinsAll <- filter(JohnsHopkinsAll, Date != Exclusion2)
JohnsHopkinsAll <- filter(JohnsHopkinsAll, Date != Exclusion3)
JohnsHopkinsAll <- filter(JohnsHopkinsAll, Date != Exclusion4)
JohnsHopkinsAll <- filter(JohnsHopkinsAll, Date != Exclusion5)
JohnsHopkinsCountryRegion <- filter(JohnsHopkinsAll, CountryRegion == CountryRegionFilter)
JohnsHopkinsProvinceState <- filter(JohnsHopkinsCountryRegion, ProvinceState == ProvinceStateFilter)
JohnsHopkinsAdmin2 <- filter(JohnsHopkinsProvinceState, Admin2 == Admin2Filter)
#Order ProvinceState by County and add NewCases
JohnsHopkinsProvinceState <- JohnsHopkinsProvinceState[order(JohnsHopkinsProvinceState$Admin2),]
JohnsHopkinsProvinceState$NewCasesByCounty = JohnsHopkinsProvinceState$Confirmed - lag(JohnsHopkinsProvinceState$Confirmed, default = 0)
##### Aggregate data by filter #####
#CountryRegion Aggregate by Date
### Needs input dataframe here
NewData <- JohnsHopkinsCountryRegion
#Aggregate content by date...
# ConfirmedCases <- NewData$Confirmed
# Deaths <- NewData$Deaths
# ActiveCases <- NewData$Active
# NewData <- data.frame(Date, ConfirmedCases, Deaths, ActiveCases)
Data <- aggregate(NewData$Confirmed, by = list(NewData$Date), FUN = sum)
Date <- Data$Group.1
Confirmed <- Data$x
Data <- aggregate(NewData$Deaths, by = list(NewData$Date), FUN = sum)
Deaths <- Data$x
Data <- aggregate(NewData$Active, by = list(NewData$Date), FUN = sum)
Active <- Data$x
Data <- aggregate(NewData$Recovered, by = list(NewData$Date), FUN = sum)
Recovered <- Data$x
NewConfirmed = Confirmed - lag(Confirmed, default = 0)
MovingAves7dayTemp <- c(NA, NA, NA, NA, NA, NA)
MovingAves7day <- movingaves(x = NewConfirmed, window = 7, integer = TRUE)
PercentChangeDaily = ((MovingAves7day - lag(MovingAves7day, default = 0)) / lag(MovingAves7day, default = 0)) * 100
PercentChangeDaily[which(!is.finite(PercentChangeDaily))] <- 1
MovingAvesPercentChangeTemp <- c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA)
MovingAvesPercentChange <- movingaves(x = PercentChangeDaily, window = 7, integer = FALSE)
#Add NA values
MovingAves7day <- append(MovingAves7dayTemp, MovingAves7day)
PercentChangeDaily <- append(MovingAves7dayTemp, PercentChangeDaily)
MovingAvesPercentChange <- append(MovingAvesPercentChangeTemp, MovingAvesPercentChange)
#Provide new name for data here:
NewData <- data.frame(Date, Confirmed, NewConfirmed, MovingAves7day, PercentChangeDaily, MovingAvesPercentChange, Active, Recovered, Deaths)
CountryRegionAgg <- NewData
#ProvinceState Aggregate by Date
### Needs input dataframe here
NewData <- JohnsHopkinsProvinceState
#Aggregate content by date...
# ConfirmedCases <- NewData$Confirmed
# Deaths <- NewData$Deaths
# ActiveCases <- NewData$Active
# NewData <- data.frame(Date, ConfirmedCases, Deaths, ActiveCases)
Data <- aggregate(NewData$Confirmed, by = list(NewData$Date), FUN = sum)
Date <- Data$Group.1
Confirmed <- Data$x
Data <- aggregate(NewData$Deaths, by = list(NewData$Date), FUN = sum)
Deaths <- Data$x
Data <- aggregate(NewData$Active, by = list(NewData$Date), FUN = sum)
Active <- Data$x
Data <- aggregate(NewData$Recovered, by = list(NewData$Date), FUN = sum)
Recovered <- Data$x
NewConfirmed = Confirmed - lag(Confirmed, default = 0)
MovingAves7dayTemp <- c(NA, NA, NA, NA, NA, NA)
MovingAves7day <- movingaves(x = NewConfirmed, window = 7, integer = TRUE)
PercentChangeDaily = ((MovingAves7day - lag(MovingAves7day, default = 0)) / lag(MovingAves7day, default = 0)) * 100
PercentChangeDaily[which(!is.finite(PercentChangeDaily))] <- 1
MovingAvesPercentChangeTemp <- c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA)
MovingAvesPercentChange <- movingaves(x = PercentChangeDaily, window = 7, integer = FALSE)
#Add NA values
MovingAves7day <- append(MovingAves7dayTemp, MovingAves7day)
PercentChangeDaily <- append(MovingAves7dayTemp, PercentChangeDaily)
MovingAvesPercentChange <- append(MovingAvesPercentChangeTemp, MovingAvesPercentChange)
#Provide new name for data here:
NewData <- data.frame(Date, Confirmed, NewConfirmed, MovingAves7day, PercentChangeDaily, MovingAvesPercentChange, Active, Recovered, Deaths)
ProvinceStateAgg <- NewData
#Admin2 Aggregate by Date
### Needs input dataframe here
NewData <- JohnsHopkinsAdmin2
#Aggregate content by date...
# ConfirmedCases <- NewData$Confirmed
# Deaths <- NewData$Deaths
# ActiveCases <- NewData$Active
# NewData <- data.frame(Date, ConfirmedCases, Deaths, ActiveCases)
Data <- aggregate(NewData$Confirmed, by = list(NewData$Date), FUN = sum)
Date <- Data$Group.1
Confirmed <- Data$x
Data <- aggregate(NewData$Deaths, by = list(NewData$Date), FUN = sum)
Deaths <- Data$x
Data <- aggregate(NewData$Active, by = list(NewData$Date), FUN = sum)
Active <- Data$x
Data <- aggregate(NewData$Recovered, by = list(NewData$Date), FUN = sum)
Recovered <- Data$x
NewConfirmed = Confirmed - lag(Confirmed, default = 0)
MovingAves7dayTemp <- c(NA, NA, NA, NA, NA, NA)
MovingAves7day <- movingaves(x = NewConfirmed, window = 7, integer = TRUE)
PercentChangeDaily = ((MovingAves7day - lag(MovingAves7day, default = 0)) / lag(MovingAves7day, default = 0)) * 100
PercentChangeDaily[which(!is.finite(PercentChangeDaily))] <- 1
MovingAvesPercentChangeTemp <- c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA)
MovingAvesPercentChange <- movingaves(x = PercentChangeDaily, window = 7, integer = FALSE)
#Add NA values
MovingAves7day <- append(MovingAves7dayTemp, MovingAves7day)
PercentChangeDaily <- append(MovingAves7dayTemp, PercentChangeDaily)
MovingAvesPercentChange <- append(MovingAvesPercentChangeTemp, MovingAvesPercentChange)
#Provide new name for data here:
NewData <- data.frame(Date, Confirmed, NewConfirmed, MovingAves7day, PercentChangeDaily, MovingAvesPercentChange, Active, Recovered, Deaths)
Admin2Agg <- NewData
#####PLOT DATA FOR SHINY APP#####
#Plot Admin2 Cases for top of dashboard
PlotTitle <- paste("COVID-19 Cases Over Time in", Admin2Filter, "County,", ProvinceStateFilter)
CasesAdmin2 <- plot_ly(Admin2Agg, x = ~Date, y = ~Confirmed, name = "Confirmed Cases", type = "scatter", mode = "lines", line = list(color = "blue", width = 4))
CasesAdmin2 <- CasesAdmin2 %>% add_trace(y = ~Recovered, name = "Recovered Cases", mode = "lines", line = list(color = "green", width = 4))
CasesAdmin2 <- CasesAdmin2 %>% add_trace(y = ~Deaths, name = "Deaths", mode = "lines", line = list(color = "red", width = 4))
CasesAdmin2 <- CasesAdmin2 %>% layout(title = PlotTitle, xaxis = list(title = "Date"), yaxis = list(title = "Cases"))
#Plot ProvinceState Cases
PlotTitle <- paste("COVID-19 Cases Over Time in", ProvinceStateFilter, ",", CountryRegionFilter)
CasesProvinceState <- plot_ly(ProvinceStateAgg, x = ~Date, y = ~Confirmed, name = "Confirmed Cases", type = "scatter", mode = "lines", line = list(color = "blue", width = 4))
CasesProvinceState <- CasesProvinceState %>% add_trace(y = ~Recovered, name = "Recovered Cases", mode = "lines", line = list(color = "green", width = 4))
CasesProvinceState <- CasesProvinceState %>% add_trace(y = ~Deaths, name = "Deaths", mode = "lines", line = list(color = "red", width = 4))
CasesProvinceState <- CasesProvinceState %>% layout(title = PlotTitle, xaxis = list(title = "Date"), yaxis = list(title = "Cases"))
#Plot CountryRegion Cases
PlotTitle <- paste("COVID-19 Cases Over Time in", CountryRegionFilter)
CasesCountryRegion <- plot_ly(CountryRegionAgg, x = ~Date, y = ~Confirmed, name = "Confirmed Cases", type = "scatter", mode = "lines", line = list(color = "blue", width = 4))
CasesCountryRegion <- CasesCountryRegion %>% add_trace(y = ~Recovered, name = "Recovered Cases", mode = "lines", line = list(color = "green", width = 4))
CasesCountryRegion <- CasesCountryRegion %>% add_trace(y = ~Deaths, name = "Deaths", mode = "lines", line = list(color = "red", width = 4))
CasesCountryRegion <- CasesCountryRegion %>% layout(title = PlotTitle, xaxis = list(title = "Date"), yaxis = list(title = "Cases"))
#Plot Admin2 New Cases
PlotTitle <- paste("New COVID-19 Cases Over Time in", Admin2Filter, "County,", ProvinceStateFilter)
NewCasesAdmin2 <- plot_ly(Admin2Agg, x = ~Date, y = ~NewConfirmed, type = "bar")
NewCasesAdmin2 <- NewCasesAdmin2 %>% layout(title = PlotTitle)
#Plot Admin2 Trendline
PlotTitle <- paste("Percentage Change in 7-day Average New Cases in", Admin2Filter, "County,", ProvinceStateFilter)
Admin2Trend <- plot_ly(Admin2Agg, x = ~Date, y = ~PercentChangeDaily, name = "Percentage Change in 7-day Average New Cases", type = "scatter", mode = "markers")
Admin2Trend <- Admin2Trend %>% add_trace(y = ~MovingAvesPercentChange, name = "Trendline", mode = "lines", line = list(color = "red", shape = "spline", width = 4))
Admin2Trend <- Admin2Trend %>% layout(title = PlotTitle, xaxis = list(title = "Date"), yaxis = list(title = "Percent Change in New Cases (in %)"))
#Plot ProvinceState New Cases
PlotTitle <- paste("New COVID-19 Cases Over Time in", ProvinceStateFilter, ",", CountryRegionFilter)
NewCasesProvinceState <- plot_ly(ProvinceStateAgg, x = ~Date, y = ~NewConfirmed, type = "bar")
NewCasesProvinceState <- NewCasesProvinceState %>% layout(title = PlotTitle)
#Plot ProvinceState Trendline
PlotTitle <- paste("Percentage Change in 7-day Average New Cases in", ProvinceStateFilter, ",", CountryRegionFilter)
ProvinceStateTrend <- plot_ly(ProvinceStateAgg, x = ~Date, y = ~PercentChangeDaily, name = "Percentage Change in 7-day Average New Cases", type = "scatter", mode = "markers")
ProvinceStateTrend <- ProvinceStateTrend %>% add_trace(y = ~MovingAvesPercentChange, name = "Trendline", mode = "lines", line = list(color = "red", shape = "spline", width = 4))
ProvinceStateTrend <- ProvinceStateTrend %>% layout(title = PlotTitle, xaxis = list(title = "Date"), yaxis = list(title = "Percent Change in New Cases (in %)"))
#Plot CountryRegion New Cases
PlotTitle <- paste("New COVID-19 Cases Over Time in", CountryRegionFilter)
NewCasesCountryRegion <- plot_ly(CountryRegionAgg, x = ~Date, y = ~NewConfirmed, type = "bar")
NewCasesCountryRegion <- NewCasesCountryRegion %>% layout(title = PlotTitle)
#Plot CountryRegion Trendline
PlotTitle <- paste("Percentage Change in 7-day Average New Cases in", CountryRegionFilter)
CountryRegionTrend <- plot_ly(CountryRegionAgg, x = ~Date, y = ~PercentChangeDaily, name = "Percentage Change in 7-day Average New Cases", type = "scatter", mode = "markers")
CountryRegionTrend <- CountryRegionTrend %>% add_trace(y = ~MovingAvesPercentChange, name = "Trendline", mode = "lines", line = list(color = "red", shape = "spline", width = 4))
CountryRegionTrend <- CountryRegionTrend %>% layout(title = PlotTitle, xaxis = list(title = "Date"), yaxis = list(title = "Percent Change in New Cases (in %)", range = c(-800, 600)))
CountryRegionTrend
#Plot ProvinceState Counties Pie Chart
today <- ymd_hms(today)
PlotTitle <- paste("Today's New Cases by County in", ProvinceStateFilter, "(", today, ")")
ProvinceStateNewCasesLocations <- filter(JohnsHopkinsProvinceState, Date == today)
County <- ProvinceStateNewCasesLocations$Admin2
Date <- ProvinceStateNewCasesLocations$Date
NewCasesByCounty <- ProvinceStateNewCasesLocations$NewCasesByCounty
# NewCases <- (NewCases$Confirmed - lag(NewCases$Confirmed, default = 0))
# NewCasesDate <- JohnsHopkinsProvinceState$Date
# NewCasesDate <- data.frame(NewCasesDate, NewCases)
# NewCasesDate <- filter(NewCasesDate, NewCasesDate == today)
# NewCases <- NewCasesDate$NewCases
ProvinceStateNewCasesLocations <- data.frame(Date, County, NewCasesByCounty)
ProvinceStateNewCasesLocations <- filter(ProvinceStateNewCasesLocations, NewCasesByCounty > 0)
ProvinceStatePieChart <- plot_ly(ProvinceStateNewCasesLocations, labels = ~County, values = ~NewCasesByCounty, type = "pie")
ProvinceStatePieChart <- ProvinceStatePieChart %>% layout(title = PlotTitle,
xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE)
)
# Define server logic
shinyServer(function(input, output) {
#Plot needs to go HERE:
output$CasesAdmin2 <- renderPlotly(CasesAdmin2)
output$CasesProvinceState <- renderPlotly(CasesProvinceState)
output$CasesCountryRegion <- renderPlotly(CasesCountryRegion)
output$NewCasesAdmin2 <- renderPlotly(NewCasesAdmin2)
output$NewCasesProvinceState <- renderPlotly(NewCasesProvinceState)
output$NewCasesCountryRegion <- renderPlotly(NewCasesCountryRegion)
output$ProvinceStatePieChart <- renderPlotly(ProvinceStatePieChart)
output$Admin2Trend <- renderPlotly(Admin2Trend)
output$ProvinceStateTrend <- renderPlotly(ProvinceStateTrend)
output$CountryRegionTrend <- renderPlotly(CountryRegionTrend)
})
##V2.0 Beta
#Load Packages
library("dplyr")
library("plotly")
library("lubridate")
library("shiny")
library("accelerometry")
library("RCurl")
#Load JohnsHopkinsAll from GitHub
#JohnsHopkinsAll.csv needs to be updated manually using update.R
#Script references the master branch, so remember to update the MASTER branch not just the BETA branch
#FEATURE TO ADD LATER <- Possible to write this update into script automatically? Need to solve github sync issue with large files....
##### NECESSARY FOR WEB PUBLISHING #####
#GitHubURL <- getURL("https://raw.githubusercontent.com/geofflambeth/COVID-19app/master/ShinyApp/JohnsHopkinsAll.csv")
#JohnsHopkinsAll <- read.csv(text = GitHubURL)
#JohnsHopkinsAll$Date <- parse_date_time(JohnsHopkinsAll$Date, orders = c("ymd"))
#JohnsHopkinsAll$DateTime <- parse_date_time(JohnsHopkinsAll$DateTime, orders = c("ymd_HMS"))
##### FASTER FOR LOCAL USE #####
setwd("~/Google Drive/GitHub/COVID-19app/ShinyApp/")
JohnsHopkinsAll <- read.csv("JohnsHopkinsAll.csv")
JohnsHopkinsAll$Date <- parse_date_time(JohnsHopkinsAll$Date, orders = c("ymd"))
JohnsHopkinsAll$DateTime <- parse_date_time(JohnsHopkinsAll$DateTime, orders = c("ymd_HMS"))
##FILTER RULES HERE##
today <- format(Sys.Date(), "%Y-%m-%d 00:00:00")
CountryRegionFilter <- "US"
ProvinceStateFilter <- "New Mexico"
Admin2Filter <- "Santa Fe"
Exclusion1 <- "2020-04-22"
Exclusion1 <- parse_date_time(Exclusion1, orders = "ymd")
Exclusion2 <- "2020-04-23"
Exclusion2 <- parse_date_time(Exclusion2, orders = "ymd")
Exclusion3 <- "2020-04-13"
Exclusion3 <- parse_date_time(Exclusion3, orders = "ymd")
Exclusion4 <- "2020-04-27"
Exclusion4 <- parse_date_time(Exclusion4, orders = "ymd")
Exclusion5 <- "2020-04-28"
Exclusion5 <- parse_date_time(Exclusion5, orders = "ymd")
#Filter JohnsHopkinsAll
#FEATURE TO ADD LATER <- Select filters from ShinyApp ui.R
JohnsHopkinsAll <- filter(JohnsHopkinsAll, Date != Exclusion1)
JohnsHopkinsAll <- filter(JohnsHopkinsAll, Date != Exclusion2)
JohnsHopkinsAll <- filter(JohnsHopkinsAll, Date != Exclusion3)
JohnsHopkinsAll <- filter(JohnsHopkinsAll, Date != Exclusion4)
JohnsHopkinsAll <- filter(JohnsHopkinsAll, Date != Exclusion5)
JohnsHopkinsCountryRegion <- filter(JohnsHopkinsAll, CountryRegion == CountryRegionFilter)
JohnsHopkinsProvinceState <- filter(JohnsHopkinsCountryRegion, ProvinceState == ProvinceStateFilter)
JohnsHopkinsAdmin2 <- filter(JohnsHopkinsProvinceState, Admin2 == Admin2Filter)
#Order ProvinceState by County and add NewCases
JohnsHopkinsProvinceState <- JohnsHopkinsProvinceState[order(JohnsHopkinsProvinceState$Admin2),]
JohnsHopkinsProvinceState$NewCasesByCounty = JohnsHopkinsProvinceState$Confirmed - lag(JohnsHopkinsProvinceState$Confirmed, default = 0)
##### Aggregate data by filter #####
#CountryRegion Aggregate by Date
### Needs input dataframe here
NewData <- JohnsHopkinsCountryRegion
#Aggregate content by date...
# ConfirmedCases <- NewData$Confirmed
# Deaths <- NewData$Deaths
# ActiveCases <- NewData$Active
# NewData <- data.frame(Date, ConfirmedCases, Deaths, ActiveCases)
Data <- aggregate(NewData$Confirmed, by = list(NewData$Date), FUN = sum)
Date <- Data$Group.1
Confirmed <- Data$x
Data <- aggregate(NewData$Deaths, by = list(NewData$Date), FUN = sum)
Deaths <- Data$x
Data <- aggregate(NewData$Active, by = list(NewData$Date), FUN = sum)
Active <- Data$x
Data <- aggregate(NewData$Recovered, by = list(NewData$Date), FUN = sum)
Recovered <- Data$x
NewConfirmed = Confirmed - lag(Confirmed, default = 0)
MovingAves7dayTemp <- c(NA, NA, NA, NA, NA, NA)
MovingAves7day <- movingaves(x = NewConfirmed, window = 7, integer = TRUE)
PercentChangeDaily = ((MovingAves7day - lag(MovingAves7day, default = 0)) / lag(MovingAves7day, default = 0)) * 100
PercentChangeDaily[which(!is.finite(PercentChangeDaily))] <- 1
MovingAvesPercentChangeTemp <- c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA)
MovingAvesPercentChange <- movingaves(x = PercentChangeDaily, window = 7, integer = FALSE)
#Add NA values
MovingAves7day <- append(MovingAves7dayTemp, MovingAves7day)
PercentChangeDaily <- append(MovingAves7dayTemp, PercentChangeDaily)
MovingAvesPercentChange <- append(MovingAvesPercentChangeTemp, MovingAvesPercentChange)
#Provide new name for data here:
NewData <- data.frame(Date, Confirmed, NewConfirmed, MovingAves7day, PercentChangeDaily, MovingAvesPercentChange, Active, Recovered, Deaths)
CountryRegionAgg <- NewData
#ProvinceState Aggregate by Date
### Needs input dataframe here
NewData <- JohnsHopkinsProvinceState
#Aggregate content by date...
# ConfirmedCases <- NewData$Confirmed
# Deaths <- NewData$Deaths
# ActiveCases <- NewData$Active
# NewData <- data.frame(Date, ConfirmedCases, Deaths, ActiveCases)
Data <- aggregate(NewData$Confirmed, by = list(NewData$Date), FUN = sum)
Date <- Data$Group.1
Confirmed <- Data$x
Data <- aggregate(NewData$Deaths, by = list(NewData$Date), FUN = sum)
Deaths <- Data$x
Data <- aggregate(NewData$Active, by = list(NewData$Date), FUN = sum)
Active <- Data$x
Data <- aggregate(NewData$Recovered, by = list(NewData$Date), FUN = sum)
Recovered <- Data$x
NewConfirmed = Confirmed - lag(Confirmed, default = 0)
MovingAves7dayTemp <- c(NA, NA, NA, NA, NA, NA)
MovingAves7day <- movingaves(x = NewConfirmed, window = 7, integer = TRUE)
PercentChangeDaily = ((MovingAves7day - lag(MovingAves7day, default = 0)) / lag(MovingAves7day, default = 0)) * 100
PercentChangeDaily[which(!is.finite(PercentChangeDaily))] <- 1
MovingAvesPercentChangeTemp <- c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA)
MovingAvesPercentChange <- movingaves(x = PercentChangeDaily, window = 7, integer = FALSE)
#Add NA values
MovingAves7day <- append(MovingAves7dayTemp, MovingAves7day)
PercentChangeDaily <- append(MovingAves7dayTemp, PercentChangeDaily)
MovingAvesPercentChange <- append(MovingAvesPercentChangeTemp, MovingAvesPercentChange)
#Provide new name for data here:
NewData <- data.frame(Date, Confirmed, NewConfirmed, MovingAves7day, PercentChangeDaily, MovingAvesPercentChange, Active, Recovered, Deaths)
ProvinceStateAgg <- NewData
#Admin2 Aggregate by Date
### Needs input dataframe here
NewData <- JohnsHopkinsAdmin2
#Aggregate content by date...
# ConfirmedCases <- NewData$Confirmed
# Deaths <- NewData$Deaths
# ActiveCases <- NewData$Active
# NewData <- data.frame(Date, ConfirmedCases, Deaths, ActiveCases)
Data <- aggregate(NewData$Confirmed, by = list(NewData$Date), FUN = sum)
Date <- Data$Group.1
Confirmed <- Data$x
Data <- aggregate(NewData$Deaths, by = list(NewData$Date), FUN = sum)
Deaths <- Data$x
Data <- aggregate(NewData$Active, by = list(NewData$Date), FUN = sum)
Active <- Data$x
Data <- aggregate(NewData$Recovered, by = list(NewData$Date), FUN = sum)
Recovered <- Data$x
NewConfirmed = Confirmed - lag(Confirmed, default = 0)
MovingAves7dayTemp <- c(NA, NA, NA, NA, NA, NA)
MovingAves7day <- movingaves(x = NewConfirmed, window = 7, integer = TRUE)
PercentChangeDaily = ((MovingAves7day - lag(MovingAves7day, default = 0)) / lag(MovingAves7day, default = 0)) * 100
PercentChangeDaily[which(!is.finite(PercentChangeDaily))] <- 1
MovingAvesPercentChangeTemp <- c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA)
MovingAvesPercentChange <- movingaves(x = PercentChangeDaily, window = 7, integer = FALSE)
#Add NA values
MovingAves7day <- append(MovingAves7dayTemp, MovingAves7day)
PercentChangeDaily <- append(MovingAves7dayTemp, PercentChangeDaily)
MovingAvesPercentChange <- append(MovingAvesPercentChangeTemp, MovingAvesPercentChange)
#Provide new name for data here:
NewData <- data.frame(Date, Confirmed, NewConfirmed, MovingAves7day, PercentChangeDaily, MovingAvesPercentChange, Active, Recovered, Deaths)
Admin2Agg <- NewData
#####PLOT DATA FOR SHINY APP#####
#Plot Admin2 Cases for top of dashboard
PlotTitle <- paste("COVID-19 Cases Over Time in", Admin2Filter, "County,", ProvinceStateFilter)
CasesAdmin2 <- plot_ly(Admin2Agg, x = ~Date, y = ~Confirmed, name = "Confirmed Cases", type = "scatter", mode = "lines", line = list(color = "blue", width = 4))
CasesAdmin2 <- CasesAdmin2 %>% add_trace(y = ~Recovered, name = "Recovered Cases", mode = "lines", line = list(color = "green", width = 4))
CasesAdmin2 <- CasesAdmin2 %>% add_trace(y = ~Deaths, name = "Deaths", mode = "lines", line = list(color = "red", width = 4))
CasesAdmin2 <- CasesAdmin2 %>% layout(title = PlotTitle, xaxis = list(title = "Date"), yaxis = list(title = "Cases"))
#Plot ProvinceState Cases
PlotTitle <- paste("COVID-19 Cases Over Time in", ProvinceStateFilter, ",", CountryRegionFilter)
CasesProvinceState <- plot_ly(ProvinceStateAgg, x = ~Date, y = ~Confirmed, name = "Confirmed Cases", type = "scatter", mode = "lines", line = list(color = "blue", width = 4))
CasesProvinceState <- CasesProvinceState %>% add_trace(y = ~Recovered, name = "Recovered Cases", mode = "lines", line = list(color = "green", width = 4))
CasesProvinceState <- CasesProvinceState %>% add_trace(y = ~Deaths, name = "Deaths", mode = "lines", line = list(color = "red", width = 4))
CasesProvinceState <- CasesProvinceState %>% layout(title = PlotTitle, xaxis = list(title = "Date"), yaxis = list(title = "Cases"))
#Plot CountryRegion Cases
PlotTitle <- paste("COVID-19 Cases Over Time in", CountryRegionFilter)
CasesCountryRegion <- plot_ly(CountryRegionAgg, x = ~Date, y = ~Confirmed, name = "Confirmed Cases", type = "scatter", mode = "lines", line = list(color = "blue", width = 4))
CasesCountryRegion <- CasesCountryRegion %>% add_trace(y = ~Recovered, name = "Recovered Cases", mode = "lines", line = list(color = "green", width = 4))
CasesCountryRegion <- CasesCountryRegion %>% add_trace(y = ~Deaths, name = "Deaths", mode = "lines", line = list(color = "red", width = 4))
CasesCountryRegion <- CasesCountryRegion %>% layout(title = PlotTitle, xaxis = list(title = "Date"), yaxis = list(title = "Cases"))
#Plot Admin2 New Cases
PlotTitle <- paste("New COVID-19 Cases Over Time in", Admin2Filter, "County,", ProvinceStateFilter)
NewCasesAdmin2 <- plot_ly(Admin2Agg, x = ~Date, y = ~NewConfirmed, type = "bar")
NewCasesAdmin2 <- NewCasesAdmin2 %>% layout(title = PlotTitle)
#Plot Admin2 Trendline
PlotTitle <- paste("Percentage Change in 7-day Average New Cases in", Admin2Filter, "County,", ProvinceStateFilter)
Admin2Trend <- plot_ly(Admin2Agg, x = ~Date, y = ~PercentChangeDaily, name = "Percentage Change in 7-day Average New Cases", type = "scatter", mode = "markers")
Admin2Trend <- Admin2Trend %>% add_trace(y = ~MovingAvesPercentChange, name = "Trendline", mode = "lines", line = list(color = "red", shape = "spline", width = 4))
Admin2Trend <- Admin2Trend %>% layout(title = PlotTitle, xaxis = list(title = "Date"), yaxis = list(title = "Percent Change in New Cases (in %)"))
#Plot ProvinceState New Cases
PlotTitle <- paste("New COVID-19 Cases Over Time in", ProvinceStateFilter, ",", CountryRegionFilter)
NewCasesProvinceState <- plot_ly(ProvinceStateAgg, x = ~Date, y = ~NewConfirmed, type = "bar")
NewCasesProvinceState <- NewCasesProvinceState %>% layout(title = PlotTitle)
#Plot ProvinceState Trendline
PlotTitle <- paste("Percentage Change in 7-day Average New Cases in", ProvinceStateFilter, ",", CountryRegionFilter)
ProvinceStateTrend <- plot_ly(ProvinceStateAgg, x = ~Date, y = ~PercentChangeDaily, name = "Percentage Change in 7-day Average New Cases", type = "scatter", mode = "markers")
ProvinceStateTrend <- ProvinceStateTrend %>% add_trace(y = ~MovingAvesPercentChange, name = "Trendline", mode = "lines", line = list(color = "red", shape = "spline", width = 4))
ProvinceStateTrend <- ProvinceStateTrend %>% layout(title = PlotTitle, xaxis = list(title = "Date"), yaxis = list(title = "Percent Change in New Cases (in %)"))
#Plot CountryRegion New Cases
PlotTitle <- paste("New COVID-19 Cases Over Time in", CountryRegionFilter)
NewCasesCountryRegion <- plot_ly(CountryRegionAgg, x = ~Date, y = ~NewConfirmed, type = "bar")
NewCasesCountryRegion <- NewCasesCountryRegion %>% layout(title = PlotTitle)
#Plot CountryRegion Trendline
PlotTitle <- paste("Percentage Change in 7-day Average New Cases in", CountryRegionFilter)
CountryRegionTrend <- plot_ly(CountryRegionAgg, x = ~Date, y = ~PercentChangeDaily, name = "Percentage Change in 7-day Average New Cases", type = "scatter", mode = "markers")
CountryRegionTrend <- CountryRegionTrend %>% add_trace(y = ~MovingAvesPercentChange, name = "Trendline", mode = "lines", line = list(color = "red", shape = "spline", width = 4))
CountryRegionTrend <- CountryRegionTrend %>% layout(title = PlotTitle, xaxis = list(title = "Date"), yaxis = list(title = "Percent Change in New Cases (in %)", range = c(-800, 600)))
CountryRegionTrend
#Plot ProvinceState Counties Pie Chart
today <- ymd_hms(today)
PlotTitle <- paste("Today's New Cases by County in", ProvinceStateFilter, "(", today, ")")
ProvinceStateNewCasesLocations <- filter(JohnsHopkinsProvinceState, Date == today)
County <- ProvinceStateNewCasesLocations$Admin2
Date <- ProvinceStateNewCasesLocations$Date
NewCasesByCounty <- ProvinceStateNewCasesLocations$NewCasesByCounty
# NewCases <- (NewCases$Confirmed - lag(NewCases$Confirmed, default = 0))
# NewCasesDate <- JohnsHopkinsProvinceState$Date
# NewCasesDate <- data.frame(NewCasesDate, NewCases)
# NewCasesDate <- filter(NewCasesDate, NewCasesDate == today)
# NewCases <- NewCasesDate$NewCases
ProvinceStateNewCasesLocations <- data.frame(Date, County, NewCasesByCounty)
ProvinceStateNewCasesLocations <- filter(ProvinceStateNewCasesLocations, NewCasesByCounty > 0)
ProvinceStatePieChart <- plot_ly(ProvinceStateNewCasesLocations, labels = ~County, values = ~NewCasesByCounty, type = "pie")
ProvinceStatePieChart <- ProvinceStatePieChart %>% layout(title = PlotTitle,
xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE)
)
# Define server logic
shinyServer(function(input, output) {
#Plot needs to go HERE:
output$CasesAdmin2 <- renderPlotly(CasesAdmin2)
output$CasesProvinceState <- renderPlotly(CasesProvinceState)
output$CasesCountryRegion <- renderPlotly(CasesCountryRegion)
output$NewCasesAdmin2 <- renderPlotly(NewCasesAdmin2)
output$NewCasesProvinceState <- renderPlotly(NewCasesProvinceState)
output$NewCasesCountryRegion <- renderPlotly(NewCasesCountryRegion)
output$ProvinceStatePieChart <- renderPlotly(ProvinceStatePieChart)
output$Admin2Trend <- renderPlotly(Admin2Trend)
output$ProvinceStateTrend <- renderPlotly(ProvinceStateTrend)
output$CountryRegionTrend <- renderPlotly(CountryRegionTrend)
})
runApp()
shiny::runApp()
shiny::runApp()
##This script needs to be run after pulling down updates from JohnsHopkins origin or upstream...
##Changes need to be committed to master after running
setwd("~/Google Drive/GitHub/COVID-19app/csse_covid_19_data/csse_covid_19_daily_reports/")
library("dplyr")
library("lubridate")
#Load JohnsHopkinsAll from cloned Johns Hopkins .csv files in /ccse_covid_19_daily_reports/
JohnsHopkinsAll <- list.files(pattern = "*.csv", full.names = TRUE)
JohnsHopkinsAll <- lapply(JohnsHopkinsAll,function(i){
read.csv(i, header=TRUE)
})
JohnsHopkinsAll <- bind_rows(JohnsHopkinsAll)
###Clean JohnsHopkinsAll###
#Clean Dates
Last.Update <- parse_date_time(JohnsHopkinsAll$Last.Update, orders = c("ymd_HMS", "mdy_HM"))
Last_Update <- parse_date_time(JohnsHopkinsAll$Last_Update, orders = c("ymd_HMS", "mdy_HM"))
Last.Update[is.na(Last.Update)] <- Last_Update[!is.na(Last_Update)]
DateTime <- Last.Update
Date <- format(DateTime, "%Y-%m-%d 00:00:00")
Date <- parse_date_time(Date, orders = c("ymd_HMS"))
#Clean Province/State
Province.State <- JohnsHopkinsAll$Province.State
Province_State <- JohnsHopkinsAll$Province_State
Province.State[is.na(Province.State)] <- Province_State[!is.na(Province_State)]
ProvinceState <- Province.State
#Clean Country/Region
Country.Region <- JohnsHopkinsAll$Country.Region
Country_Region <- JohnsHopkinsAll$Country_Region
Country.Region[is.na(Country.Region)] <- Country_Region[!is.na(Country_Region)]
CountryRegion <- Country.Region
#Clean Province/State
Province.State <- JohnsHopkinsAll$Province.State
Province_State <- JohnsHopkinsAll$Province_State
Province.State[is.na(Province.State)] <- Province_State[!is.na(Province_State)]
ProvinceState <- Province.State
#Collect Regular Attributes (Simpler than dates, location, etc...)
Confirmed <- JohnsHopkinsAll$Confirmed
Deaths <- JohnsHopkinsAll$Deaths
Recovered <- JohnsHopkinsAll$Recovered
Active <- JohnsHopkinsAll$Active
FIPS <- JohnsHopkinsAll$FIPS
Admin2 <- JohnsHopkinsAll$Admin2
#Join into new dataframe
JohnsHopkinsAll <- data.frame(Date, DateTime, ProvinceState, CountryRegion, Admin2, FIPS, Confirmed, Active, Deaths, Recovered)
#Write out as updated JohnsHopkinsAll.csv
#This file will be read in by server.R where filtering and analysis will begin
write.csv(JohnsHopkinsAll, "../../ShinyApp/JohnsHopkinsAll.csv")
